generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id          Int      @id @default(autoincrement())
  rol         String   @db.VarChar(30)
  username    String   @db.VarChar(30)
  password    String   @db.VarChar(60)
  created_at  DateTime @default(now()) @map("created_at")
  @@map("users")
}


model employees {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(40)
  lastname   String   @db.VarChar(40)
  ci         String   @db.VarChar(13) @unique
  rol    String   @db.VarChar(30)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now()) @map("created_at")

  employee_contacts   employee_contacts[]
  payrolls            payrolls[]
  vehicles            vehicles[]

  @@map("employees")
}

model employee_contacts {
  id              Int      @id @default(autoincrement())
  employee_id     Int
  contact_info    String   @unique @db.VarChar(100)
  created_at      DateTime @default(now()) @map("created_at")

  employees employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("employee_contacts")
}


model payrolls {
  id           Int       @id @default(autoincrement())
  status String @default("draft") 
  employee_id  Int
  base_salary  Decimal   @db.Decimal(10, 2)
  period_start DateTime
  period_end   DateTime
  payment_date DateTime
  hours_worked Int
  bonus                Decimal   @db.Decimal(10, 2) @default(0)
  deductions           Decimal   @db.Decimal(10, 2) @default(0)
  net_salary           Decimal   @db.Decimal(10, 2) 
  created_at           DateTime  @default(now()) @map("created_at")

  employees employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("payrolls")
}

model vehicle_types {
  id          Int      @id @default(autoincrement())
  type_name   String   @db.VarChar(20)
  description String   @db.VarChar(100)
  created_at  DateTime @default(now()) @map("created_at")

  vehicles vehicles[]

  @@map("vehicle_types")
}

model vehicles {
  id               Int      @id @default(autoincrement())
  driver_id        Int
  license_plate    String   @db.VarChar(10)
  total_seats      Int
  vehicle_type_id  Int
  is_active        Boolean  @default(true)
  created_at       DateTime @default(now()) @map("created_at")

  employees       employees       @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  vehicle_types   vehicle_types   @relation(fields: [vehicle_type_id], references: [id], onDelete: Cascade)
  services        services[]

  @@map("vehicles")
}

model clients {
  id         Int      @id @default(autoincrement())
  rif       String   @db.VarChar(20) @unique
  name       String   @db.VarChar(30)
  contact    String   @db.VarChar(20) @unique
  address    String   @db.VarChar(100)
  created_at DateTime @default(now()) @map("created_at")

  services services[]

  @@map("clients")
}

model providers {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(30)
  rif        String    @db.VarChar(30)
  balance    Decimal   @db.Decimal(10, 2)
  is_active  Boolean   @default(true)
  created_at DateTime  @default(now()) @map("created_at")

  provider_contacts  provider_contacts[]
  provider_invoices  provider_invoices[]

  @@map("providers")
}

model provider_contacts {
  id              Int      @id @default(autoincrement())
  provider_id     Int
  contact_info    String   @unique@db.VarChar(100)
  created_at      DateTime @default(now()) @map("created_at")

  providers providers @relation(fields: [provider_id], references: [id], onDelete: Cascade)

  @@map("provider_contacts")
}

model provider_invoices {
  id              Int       @id @default(autoincrement())
  provider_id     Int
  control_number  String    @db.VarChar(30)
  invoice_number  String    @db.VarChar(30)
  invoice_date    DateTime
  total_amount    Decimal   @db.Decimal(10, 2)
  created_at      DateTime  @default(now()) @map("created_at")

  providers           providers           @relation(fields: [provider_id], references: [id], onDelete: Cascade)
  purchase_invoices   purchase_invoices[]

  @@map("provider_invoices")
}

model expense_types {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(30)
  description String   @db.VarChar(100)
  created_at  DateTime @default(now()) @map("created_at")

  purchase_invoices purchase_invoices[]

  @@map("expense_types")
}

model purchase_invoices {
  id                    Int       @id @default(autoincrement())
  provider_invoice_id   Int
  expense_type_id       Int
  purchase_date         DateTime
  description           String    @db.Text
  exempt_amount         Decimal   @db.Decimal(10, 2)
  total_amount          Decimal   @db.Decimal(10, 2)
  created_at            DateTime  @default(now()) @map("created_at")

  provider_invoices provider_invoices @relation(fields: [provider_invoice_id], references: [id], onDelete: Cascade)
  expense_types     expense_types     @relation(fields: [expense_type_id], references: [id], onDelete: Cascade)

  @@map("purchase_invoices")
}

model services {
  id                Int       @id @default(autoincrement())
  vehicle_id        Int
  client_id         Int
  price             Decimal   @db.Decimal(10, 2)
  dropoff_location  String    @db.VarChar(100)
  number_of_people  Int
  payment_status    String    @db.VarChar(20) @default("pending") 
  created_at        DateTime  @default(now()) @map("created_at")

  vehicles  vehicles  @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
  clients   clients   @relation(fields: [client_id], references: [id], onDelete: Cascade)

  @@map("services")
  @@index([vehicle_id])
  @@index([client_id])
}