generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabla de usuarios
model users {
  id         Int      @id @default(autoincrement())
  rol        String   @db.VarChar(30)
  username   String   @db.VarChar(30)
  password   String   @db.VarChar(60)
  created_at DateTime @default(now()) @map("created_at")

  @@map("users")
}

// Empleados
model employees {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(40)
  lastname   String   @db.VarChar(40)
  ci         String   @unique @db.VarChar(13)
  rol        String   @db.VarChar(30)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now()) @map("created_at")

  employee_contacts employee_contacts[]
  payrolls          payrolls[]
  vehicles          vehicles[]

  @@map("employees")
}

model employee_contacts {
  id           Int      @id @default(autoincrement())
  employee_id  Int
  contact_info String   @unique @db.VarChar(100)
  created_at   DateTime @default(now()) @map("created_at")

  employees employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("employee_contacts")
}

// VehÃ­culos
model vehicle_types {
  id          Int      @id @default(autoincrement())
  type_name   String   @db.VarChar(20)
  description String   @db.VarChar(100)
  created_at  DateTime @default(now()) @map("created_at")

  vehicles vehicles[]

  @@map("vehicle_types")
}

model vehicles {
  id              Int      @id @default(autoincrement())
  driver_id       Int
  model           String   @db.VarChar(50)
  license_plate   String   @unique @db.VarChar(10)
  total_seats     Int
  vehicle_type_id Int
  is_active       Boolean  @default(true)
  created_at      DateTime @default(now()) @map("created_at")

  employees     employees     @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  vehicle_types vehicle_types @relation(fields: [vehicle_type_id], references: [id], onDelete: Cascade)
  services      services[]
  repairs       repair[]

  @@map("vehicles")
}

model repair {
  id            Int       @id @default(autoincrement())
  createdAt     DateTime  @default(now())
  vehicleId     Int
  vehicle       vehicles  @relation(fields: [vehicleId], references: [id])
  description   String    @db.Text
  status        String    @default("Pending")
  startDate     DateTime?
  endDate       DateTime?
  estimatedCost Float?
  finalCost     Float?

  @@map("repairs")
}

// Clientes
model clients {
  id         Int      @id @default(autoincrement())
  rif        String   @unique @db.VarChar(20)
  name       String   @db.VarChar(30)
  contact    String   @unique @db.VarChar(20)
  address    String   @db.VarChar(100)
  created_at DateTime @default(now()) @map("created_at")

  services services[]

  @@map("clients")
}

// Proveedores
model providers {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(30)
  rif        String   @db.VarChar(30)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now()) @map("created_at")

  provider_contacts provider_contacts[]
  provider_invoices provider_invoices[]

  @@map("providers")
}

model provider_contacts {
  id           Int      @id @default(autoincrement())
  provider_id  Int
  contact_info String   @unique @db.VarChar(100)
  created_at   DateTime @default(now()) @map("created_at")

  providers providers @relation(fields: [provider_id], references: [id], onDelete: Cascade)

  @@map("provider_contacts")
}

// ðŸ”¹ Enum para estados de factura
enum InvoiceStatus {
  pendiente
  cancelado
  pagado
}

// Facturas de proveedores
model provider_invoices {
  id             Int           @id @default(autoincrement())
  provider_id    Int
  control_number String        @db.VarChar(30)
  invoice_number String        @db.VarChar(30)
  invoice_date   DateTime
  subtotal       Decimal       @db.Decimal(10, 2)
  total_amount   Decimal       @db.Decimal(10, 2)
  status         InvoiceStatus @default(pendiente)
  created_at     DateTime      @default(now())

  provider      providers       @relation(fields: [provider_id], references: [id], onDelete: Cascade)
  expenses      expenses[]
  invoice_taxes invoice_taxes[]

  @@map("provider_invoices")
}

// ðŸ”¹ Impuestos especÃ­ficos por factura
model invoice_taxes {
  id                  Int      @id @default(autoincrement())
  provider_invoice_id Int
  code                String   @db.VarChar(10) // Ej: IVA, ISLR, FAOV
  name                String   @db.VarChar(100) // Ej: Impuesto al Valor Agregado
  percentage          Decimal  @db.Decimal(5, 2) // Ej: 16.00 (%)
  amount              Decimal  @db.Decimal(10, 2)
  created_at          DateTime @default(now())

  provider_invoice provider_invoices @relation(fields: [provider_invoice_id], references: [id], onDelete: Cascade)

  @@map("invoice_taxes")
}

// ðŸ”¹ Gastos con desglose
model expenses {
  id                  Int      @id @default(autoincrement())
  provider_invoice_id Int?
  description         String   @db.VarChar(255)
  subtotal            Decimal  @db.Decimal(10, 2)
  taxes               Decimal  @db.Decimal(10, 2)
  total               Decimal  @db.Decimal(10, 2)
  created_at          DateTime @default(now())

  provider_invoice provider_invoices? @relation(fields: [provider_invoice_id], references: [id], onDelete: Cascade)

  @@map("expenses")
}

// Servicios
model services {
  id             Int      @id @default(autoincrement())
  vehicle_id     Int
  client_id      Int
  start_date     DateTime
  end_date       DateTime
  invoice_number String   @unique @db.VarChar(30)
  invoice_date   DateTime @default(now())
  price          Decimal  @default(0) @db.Decimal(10, 2)
  payment_status String   @default("pending") @db.VarChar(20)
  created_at     DateTime @default(now())

  vehicles vehicles @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
  clients  clients  @relation(fields: [client_id], references: [id], onDelete: Cascade)

  @@map("services")
}

// Ingresos
model revenue {
  id          Int      @id @default(autoincrement())
  description String   @db.VarChar(255)
  amount      Decimal  @db.Decimal(10, 2)
  category    String   @default("servicio") @db.VarChar(100)
  date        DateTime
  created_at  DateTime @default(now())

  @@map("revenue")
}

// NÃ³minas
model payrolls {
  id              Int      @id @default(autoincrement())
  employee_id     Int
  status          String   @default("draft") @db.VarChar(30)
  period_start    DateTime
  period_end      DateTime
  daily_salary    Decimal  @db.Decimal(10, 2)
  total_days_paid Decimal  @db.Decimal(10, 2)
  integral_salary Decimal  @default(0) @db.Decimal(10, 2)
  annual_earnings Decimal  @default(0) @db.Decimal(10, 2)
  monthly_salary  Decimal  @db.Decimal(10, 2)
  assignments     Decimal  @db.Decimal(10, 2)
  created_at      DateTime @default(now())

  employee employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("payrolls")
}
